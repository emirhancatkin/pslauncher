<Window x:Class="PsLauncher.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:PsLauncher.Converters"
        Title="Launcher"
        Width="1280" Height="720"
        WindowStartupLocation="CenterScreen"
        KeyDown="Window_KeyDown"
        Background="{DynamicResource Bg0Brush}">

  <Window.Resources>
    <conv:ExeIconConverter x:Key="ExeIconConverter"/>
    <conv:GameCoverConverter x:Key="GameCoverConverter"/>
    <Style x:Key="GameIconItemStyle" TargetType="ListBoxItem">
      <Setter Property="Focusable" Value="True"/>
      <Setter Property="Padding" Value="0"/>
      <Setter Property="Margin" Value="8,0,8,0"/>
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
      <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="ListBoxItem">
              <Grid x:Name="Root" RenderTransformOrigin="0.5,0.5">
                <Grid.RenderTransform>
                  <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Grid.RenderTransform>
                <Border x:Name="Glow"
                        CornerRadius="16"
                        Opacity="0"
                      BorderThickness="2"
                      BorderBrush="{StaticResource GlowBrush}">
                <Border.Effect>
                  <DropShadowEffect BlurRadius="24" ShadowDepth="0" Opacity="0.7" Color="{StaticResource Glow}"/>
                </Border.Effect>
              </Border>
              <ContentPresenter/>
            </Grid>
            <ControlTemplate.Triggers>
              <Trigger Property="IsSelected" Value="True">
                  <Setter TargetName="Glow" Property="Opacity" Value="1"/>
                  <Setter TargetName="Root" Property="RenderTransform">
                    <Setter.Value>
                      <ScaleTransform ScaleX="1.08" ScaleY="1.08"/>
                    </Setter.Value>
                  </Setter>
                </Trigger>
              </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
    <Storyboard x:Key="GlowDriftAnim">
      <DoubleAnimation Storyboard.TargetName="GlowDriftLeft"
                       Storyboard.TargetProperty="X"
                       From="0" To="40" Duration="0:0:8"
                       AutoReverse="True" RepeatBehavior="Forever"/>
      <DoubleAnimation Storyboard.TargetName="GlowDriftLeft"
                       Storyboard.TargetProperty="Y"
                       From="0" To="18" Duration="0:0:10"
                       AutoReverse="True" RepeatBehavior="Forever"/>
      <DoubleAnimation Storyboard.TargetName="GlowDriftRight"
                       Storyboard.TargetProperty="X"
                       From="0" To="-36" Duration="0:0:9"
                       AutoReverse="True" RepeatBehavior="Forever"/>
      <DoubleAnimation Storyboard.TargetName="GlowDriftRight"
                       Storyboard.TargetProperty="Y"
                       From="0" To="-22" Duration="0:0:11"
                       AutoReverse="True" RepeatBehavior="Forever"/>
    </Storyboard>
  </Window.Resources>
  <Window.Triggers>
    <EventTrigger RoutedEvent="Window.Loaded">
      <BeginStoryboard Storyboard="{StaticResource GlowDriftAnim}"/>
    </EventTrigger>
  </Window.Triggers>

  <Grid>

    <Rectangle>
      <Rectangle.Fill>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
          <GradientStop Color="{StaticResource Bg0}" Offset="0"/>
          <GradientStop Color="{StaticResource Bg1}" Offset="1"/>
        </LinearGradientBrush>
      </Rectangle.Fill>
    </Rectangle>


    <Ellipse Width="660" Height="660" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="-240,-240,0,0" Opacity="0.2">
      <Ellipse.Fill>
        <RadialGradientBrush>
          <GradientStop Color="{StaticResource Glow}" Offset="0"/>
          <GradientStop Color="#00000000" Offset="1"/>
        </RadialGradientBrush>
      </Ellipse.Fill>
      <Ellipse.RenderTransform>
        <TranslateTransform x:Name="GlowDriftLeft"/>
      </Ellipse.RenderTransform>
    </Ellipse>
    <Ellipse Width="520" Height="520" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,-180,-180" Opacity="0.18">
      <Ellipse.Fill>
        <RadialGradientBrush>
          <GradientStop Color="{StaticResource Accent2}" Offset="0"/>
          <GradientStop Color="#00000000" Offset="1"/>
        </RadialGradientBrush>
      </Ellipse.Fill>
      <Ellipse.RenderTransform>
        <TranslateTransform x:Name="GlowDriftRight"/>
      </Ellipse.RenderTransform>
    </Ellipse>


    <Canvas IsHitTestVisible="False" Opacity="0.15">
      <Path Stroke="#7FB6FF" StrokeThickness="2" StrokeDashArray="2 6"
            Data="M 120,80 L 180,80 L 180,140 L 120,140 Z"/>
      <Path Stroke="#7FB6FF" StrokeThickness="2"
            Data="M 360,120 L 410,170 L 360,220 L 310,170 Z"/>
      <Path Stroke="#7FB6FF" StrokeThickness="2"
            Data="M 1020,120 A 40,40 0 1 1 1019,120"/>
      <Path Stroke="#7FB6FF" StrokeThickness="2"
            Data="M 940,520 L 980,560 L 940,600 L 900,560 Z"/>
      <Path Stroke="#7FB6FF" StrokeThickness="2"
            Data="M 170,520 A 46,46 0 1 1 169,520"/>
      <Path Stroke="#7FB6FF" StrokeThickness="2"
            Data="M 520,560 L 560,520 L 600,560 L 560,600 Z"/>
    </Canvas>

    <Grid Margin="48">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>


      <Grid Grid.Row="0" Margin="0,0,0,22">
        <Grid.ColumnDefinitions>
          <ColumnDefinition/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
          <TextBlock Text="Games" FontSize="18" FontWeight="SemiBold" Margin="0,0,16,0"/>
          <TextBlock Text="Media" FontSize="18" Foreground="{StaticResource TextDimBrush}"/>
        </StackPanel>

        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
          <Border CornerRadius="999" Background="#0C1B3D" BorderBrush="#2A4E86" BorderThickness="1" Padding="14,8" Margin="0,0,10,0">
            <TextBlock x:Name="GamepadStatus" Style="{StaticResource Dim}" Text="Gamepad: ?"/>
          </Border>
          <Button x:Name="Ds4Button" Style="{StaticResource PsPillButton}" Content="DS4Windows" Click="OpenDs4_Click"/>
          <Button x:Name="Ds4PathButton" Style="{StaticResource PsGhostButton}" Content="Set DS4 Path" Click="PickDs4_Click" Margin="10,0,0,0"/>
          <Button x:Name="FullscreenButton" Style="{StaticResource PsGhostButton}" Content="Fullscreen" Click="ToggleFullscreen_Click" Margin="10,0,0,0"/>
        </StackPanel>
      </Grid>


      <Grid Grid.Row="1">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="*"/>
        </Grid.RowDefinitions>


        <ScrollViewer Grid.Row="0" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Disabled" PanningMode="HorizontalOnly">
          <ListBox x:Name="GamesList"
                   ItemsSource="{Binding Games}"
                   SelectedIndex="{Binding SelectedIndex}"
                   ItemContainerStyle="{StaticResource GameIconItemStyle}"
                   Background="Transparent"
                   BorderThickness="0">
            <ListBox.ItemsPanel>
              <ItemsPanelTemplate>
                <StackPanel Orientation="Horizontal"/>
              </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Border Width="76" Height="76" CornerRadius="16"
                        Background="#0B1A3A"
                        BorderBrush="#223F6F" BorderThickness="1" ClipToBounds="True">
                  <Image Width="48" Height="48"
                         HorizontalAlignment="Center" VerticalAlignment="Center"
                         Stretch="UniformToFill"
                         RenderOptions.BitmapScalingMode="HighQuality"
                         RenderTransformOrigin="0.5,0.5"
                         Source="{Binding ., Converter={StaticResource GameCoverConverter}, ConverterParameter=256}">
                    <Image.RenderTransform>
                      <ScaleTransform ScaleX="1.2" ScaleY="1.2"/>
                    </Image.RenderTransform>
                  </Image>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>
        </ScrollViewer>


        <Border Grid.Row="1" CornerRadius="30" Background="#0A1326CC" BorderBrush="#1B2B55" BorderThickness="1" Padding="26" Margin="0,18,0,0">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Width="190" Height="190" CornerRadius="28" Background="#0A142E" BorderBrush="#1B2B55" BorderThickness="1" ClipToBounds="True">
              <Image Width="140" Height="140"
                     HorizontalAlignment="Center" VerticalAlignment="Center"
                     Stretch="UniformToFill"
                     RenderOptions.BitmapScalingMode="HighQuality"
                     RenderTransformOrigin="0.5,0.5"
                     Source="{Binding SelectedGame, Converter={StaticResource GameCoverConverter}, ConverterParameter=512}">
                <Image.RenderTransform>
                  <ScaleTransform ScaleX="1.15" ScaleY="1.15"/>
                </Image.RenderTransform>
              </Image>
            </Border>

            <StackPanel Grid.Column="1" Margin="22,0,0,0" VerticalAlignment="Center">
              <TextBlock Text="{Binding SelectedGame.Name}" FontSize="36" FontWeight="SemiBold" TextTrimming="CharacterEllipsis"/>
              <TextBlock Style="{StaticResource Dim}" Margin="0,6,0,0"
                         Text="{Binding SelectedGame.Description, TargetNullValue=Ready for a PS5 Adventure?}"/>
              <StackPanel Orientation="Horizontal" Margin="0,18,0,0">
                <Button Style="{StaticResource PsPillButton}" Content="Launch" Click="Launch_Click" Margin="0,0,10,0"/>
                <Button Style="{StaticResource PsGhostButton}" Content="Add" Click="Add_Click" Margin="0,0,10,0"/>
                <Button Style="{StaticResource PsGhostButton}" Content="Remove" Click="Remove_Click"/>
              </StackPanel>
              <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                <Button Style="{StaticResource PsGhostButton}" Content="Set Cover" Click="SetCover_Click" Margin="0,0,10,0"/>
                <Button Style="{StaticResource PsGhostButton}" Content="Clear Cover" Click="ClearCover_Click"/>
                <Button x:Name="AddGameButton" Style="{StaticResource PsGhostButton}" Content="Add Game" Click="Add_Click" Margin="10,0,0,0"/>
              </StackPanel>
              <TextBlock Style="{StaticResource Dim}" Margin="0,12,0,0"
                         Text="D-Pad/Stick left-right to browse | A/Enter launch | Start opens DS4Windows"/>
            </StackPanel>
          </Grid>
        </Border>
      </Grid>
    </Grid>


    <Grid x:Name="IntroOverlay" Background="#FF000000" Visibility="Collapsed" Panel.ZIndex="10">
      <MediaElement x:Name="IntroVideo"
                    LoadedBehavior="Manual"
                    UnloadedBehavior="Stop"
                    Stretch="UniformToFill"
                    MediaEnded="IntroVideo_MediaEnded"/>
    </Grid>
  </Grid>
</Window>
